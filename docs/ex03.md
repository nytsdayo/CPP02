Chapter VIII Exercise 03: BSP

## 課題概要
点が三角形の中にあるかどうかを調べるBSP関数を作ります。

## 解説

### BSPって何？
BSP（Binary Space Partitioning）は「空間を分けて判定する方法」です。
今回は「点が三角形の中にあるか？」を調べるプログラムを作ります。

### どうやって判定するの？

#### 考え方1：面積で比べる方法
三角形ABCがあって、点Pがその中にあるかを調べたいとします。

**仕組み：**
- 大きな三角形ABC の面積
- 点Pから作る小さな三角形3つ（PAB、PBC、PCA）の面積

**判定ルール：**
```
点Pが中にある ＝ 大きな三角形の面積 ＝ 小さな三角形3つの面積の合計
```

もし点Pが三角形の外にあると、小さな三角形の合計の方が大きくなります。

#### 考え方2：左右どちら側にあるかで判定
三角形の3つの辺それぞれについて、点Pがどちら側にあるかを調べます。

**仕組み：**
- 辺AB について：点Pは左側？右側？
- 辺BC について：点Pは左側？右側？
- 辺CA について：点Pは左側？右側？

**判定ルール：**
全部同じ側（全部左側、または全部右側）なら三角形の中にあります。

#### 三角形の面積の計算方法

##### 簡単な公式：原点移動法
一番分かりやすい方法は、三角形の一つの頂点を原点(0,0)に移動してから計算する方法です。

**公式：** `面積 = |x₂ × y₃ - x₃ × y₂| ÷ 2`

##### なぜこの式で面積が求まるの？

この公式は**「原点O(0,0)」、「点A(x₂, y₂)」、「点B(x₃, y₃)」の3つの点を結んでできる三角形OABの面積**を求める式です。

**考え方：大きな長方形から余分な部分を引き算する**

これが一番イメージしやすい方法です。
三角形OABをすっぽり囲む長方形を考え、そこから周りの不要な三角形（①、②、③）の面積を引いて計算します。

```
       B(x₃,y₃)
       ┌─────┐
       │  ②  │
   ────┼─────O(0,0)
   ③   │ OAB │
       │  ①  │  
       A(x₂,y₂)
```

**ステップ1：全体の長方形の面積**
- 横の長さが x₃、縦の長さが y₂なので、面積は `x₃ × y₂`

**ステップ2：周りの三角形の面積**
- 三角形①: 底辺 x₂、高さ y₂なので、面積は `½ × x₂ × y₂`
- 三角形②: 底辺 x₃、高さ y₃なので、面積は `½ × x₃ × y₃`  
- 三角形③: 底辺 (x₃-x₂)、高さ (y₂-y₃)なので、面積は `½ × (x₃-x₂) × (y₂-y₃)`

**ステップ3：引き算で求める**
```
三角形OABの面積 = (全体の長方形) - (① + ② + ③)

S = x₃y₂ - {½x₃y₃ + ½x₂y₂ + ½(x₃-x₂)(y₂-y₃)}
```

**ステップ4：式を整理する**
カッコの中を展開して計算していくと、最終的にとてもシンプルな形になります：

```
S = ½(x₂y₃ - x₃y₂)
```

**ステップ5：絶対値をつける**
面積は必ずプラスの値になるので、計算結果がマイナスになった場合もプラスにするために絶対値記号 | | をつけます。

**最終的な公式：** `S = |x₂y₃ - x₃y₂| / 2`

##### 実装での使い方
```cpp
// 三角形の1つの頂点を原点に移動
Fixed x2 = p2.getX() - p1.getX();  // p2からp1を引く
Fixed y2 = p2.getY() - p1.getY();
Fixed x3 = p3.getX() - p1.getX();  // p3からp1を引く  
Fixed y3 = p3.getY() - p1.getY();

// 簡単な公式で面積計算
Fixed area = |x2 * y3 - x3 * y2| / 2;
```

### 注意点
- 点が三角形の角や辺の上にある場合は「外側」として扱います
- 計算の誤差に注意が必要です

### Point クラスの設計

#### const属性の理由
```cpp
Fixed const x;
Fixed const y;
```
- **不変性**: 一度設定された座標は変更されない
- **安全性**: 意図しない変更を防ぐ
- **数学的正確性**: 点の座標は固定されるべき

#### コンストラクタの設計
```cpp
Point();                                    // (0, 0) に初期化
Point(float const x, float const y);       // 指定座標で初期化
Point(Point const& other);                 // コピーコンストラクタ
```

### BSP関数の実装アプローチ

#### 1. 面積比較法の実装例
```cpp
bool bsp(Point const a, Point const b, Point const c, Point const point) {
    Fixed area_ABC = calculateArea(a, b, c);
    Fixed area_PAB = calculateArea(point, a, b);
    Fixed area_PBC = calculateArea(point, b, c);
    Fixed area_PCA = calculateArea(point, c, a);
    
    return (area_ABC == area_PAB + area_PBC + area_PCA);
}
```

#### 2. ベクトル外積法の実装例
各辺について同じ側にあるかをチェック

### 実装上の注意点

#### 1. エッジケースの処理
- **頂点上**: 点が三角形の頂点と重なる場合 → `false`
- **辺上**: 点が三角形の辺上にある場合 → `false`
- **同一直線**: 三角形が退化している場合

#### 2. 数値精度の問題
- 固定小数点演算の精度限界
- 浮動小数点からの変換誤差
- 比較時の許容誤差

#### 3. 符号の処理
- 三角形の頂点の順序（時計回り/反時計回り）
- 外積の符号の一貫性

### テストケースの設計

#### 基本テスト
- 明らかに内部にある点
- 明らかに外部にある点
- 境界上の点（頂点、辺上）

#### エッジケース
- 非常に小さい三角形
- 細長い三角形
- 座標が大きい場合

### このモジュールの位置づけ
- **応用的課題**: 基本的なクラス実装ができれば十分
- **実践的**: 実際のグラフィックスや当たり判定で使用される技術
- **数学的**: ベクトル演算と幾何学の理解が必要



課題: 点が三角形の内側にあるかどうかを示す関数を実装する。
提出ディレクトリ:
ex03/ 
提出ファイル:
Makefile 
,
main.cpp 
,
Fixed.{h, hpp} 
,
Fixed.cpp 
,
Point.{h, hpp} 
,
Point.cpp 
,
bsp.cpp 
許可関数:
roundf 
（
<cmath> 
から）
Pointクラスの要件:
Orthodox Canonical Formで2D点を表すPointクラスを作成する。
Privateメンバー:
``` 
Fixed const 
```
 属性 
``` 
x 
```
。
Fixed const 
属性
y 
。
その他、役立つもの。
Publicメンバー:
``` 
x 
```
 と 
``` 
y 
```
 を0に初期化するデフォルトコンストラクタ。
2つの定数浮動小数点数をパラメータとして受け取り、
x 
と
y 
をそれらのパラメータで初期化するコンストラクタ。
コピーコンストラクタ。
コピー代入演算子のオーバーロード。
デストラクタ。
その他、役立つもの。
BSP関数:
適切なファイルに以下の関数を実装する。
bool bsp(Point const a, Point const b, Point const c, Point const point); 
パラメータ:
``` 
a, b, c 
```
：三角形の頂点。
point 
：チェックする点。
戻り値: 点が三角形の内側にある場合は
True 
。それ以外の場合は
False 
。
点が頂点または辺上にある場合、
False 
を返す。
備考:
このモジュールは、演習03を完了しなくても合格できる。
クラスが期待通りに動作することを確認するために、独自のテストを実装して提出すること。